
1. **Список данных для трейсинга:**
    - Shop, CRM, MES, очередь, хранилище.
      
2. **Мотивация**
   - При двунаправленном обмене сообщениями (CRM API ↔ RabbitMQ ↔ MES API), а также прямом доступе к 3D Files Storage, сложно определить, где заказ «застрял».

3. **Предлагаемое решение**
   - Использовать OpenTelemetry (Java, .NET) в Shop API, CRM API, MES API.
   - Настроить OpenTelemetry Collector — собирает трейс-данные и экспортирует в Jaeger.
   - Jaeger — хранение и UI для просмотра спанов.
   - Alert Manager/Grafana — дополнительные метрики на основе трейсинга (например, время «прохождения заказа»), алерты при аномально долгих операциях.
   - Обновление кода сервисов: внедрить библиотеки OTel, передавать orderId, userId и другие бизнес-атрибуты как теги (span attributes).
   - RabbitMQ: при publish/subscribe передавать traceId в заголовках, чтобы восстановить полную цепочку.

4. **Компромиссы**
   - Сложность внедрения OTel в проприетарных/legacy-компонентах. Требуется доработка кода, библиотеки, теги.
   - Нагрузка на Collector и Jaeger при высокой RPS (можно настраивать sampling).
   - Не всегда возможно включить трейсинг для сторонних сервисов, если нет кода/доступа.

5. **Безопасность**
   - Аутентификация и авторизация (доступ к Jaeger UI только по корпоративной учётной записи или VPN).
   - Шифрование трафика (TLS) при отправке трейс-данных.
   - Фильтрация конфиденциальных полей (чтобы в trace-спанах не передавались пароли, персональные данные).
     
6. **Автоматический мониторинг**
   - Collector может формировать метрики по длительности ключевых «span» (например, «SUBMITTED → PRICE_CALCULATED»), отправлять в Grafana/Alert Manager.
   - Алерты на превышение порога (заказ более X часов «висит» в статусе, очередь переполнена и т. п.).
   - Уведомления (messenger/email) команде поддержки.
  
7. **Ссылки на решение**
   
   [Диаграмма Alexandrit_puml](./AlexandritC4.puml)
   
   [Диаграмма Alexandrit_png](./Alexandrit.png)
   
