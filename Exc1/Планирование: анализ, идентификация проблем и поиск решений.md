## 1. Анализ проблемных мест
  
1. **Потеря или дублирование сообщений в очереди**
    - CRM API ↔ RabbitMQ и MES API ↔ RabbitMQ обмениваются сообщениями двунаправленно. Если нет надёжной конфигурации (HA/кластер) и подтверждений (ack), возможны потерянные статусы заказа и дубли, ведущие к «зависанию» заказов.
      
2. **Задержки в расчёте стоимости**
     - MES API выполняет сложные вычисления (до 30 минут), что блокирует обработку последующих заказов, повышает время ответа.
       
3. **Слабая наблюдаемость (Observability)**
    - Нет распределённого трейсинга, централизованного мониторинга и алертинга. При сбоях и задержках сложно быстро понять, на каком участке — CRM, MES, RabbitMQ или 3D Files Storage — «застрял» заказ.
      
4. **Ограниченные ресурсы инфраструктуры (один инстанс на сервис)**
    - При росте нагрузки (B2B и B2C) система не масштабируется горизонтально, есть риск перегрузки RabbitMQ и баз данных.
      
5. **Риски в работе с 3D Files Storage**
    - CRM API и MES API могут параллельно обращаться к 3D-хранилищу. При большом числе крупных файлов возникает риск долгих операций (загрузок, преобразований), замедляющих бизнес-процессы.
      
6. **Проблемы в релизном цикле**
    - Нет полноценной автоматизации тестов, QA-инженер проводит ручное E2E-тестирование; каждый high-bug блокирует релизы и вызывает сдвиг графика.

---

## 2. Перечень инициатив

1. **Высоконадежный RabbitMQ**
    - Организовать кластер/HA, настроить подтверждения (ack/retry), использовать dead-letter-очереди для отлаженной двунаправленной коммуникации CRM ↔ RMQ ↔ MES.
      
2. **Выделенный расчёт стоимости**
    - Создать отдельный сервис/воркерный пул для вычислительных задач, чтобы не блокировать MES API на длительные операции (до 30 минут).
      
3. **Внедрить централизованный мониторинг и трейсинг**
    - Использовать OpenTelemetry + Jaeger для распределённого трейсинга, собирать метрики в Prometheus/Grafana (или Alert Manager) для алертинга.
      
4. **Оптимизация работы с 3D-файлами**
    - Проверить, действительно ли необходимо прямое чтение/запись из CRM API. Возможно, вынести все операции в единый «File Service».
    - Настроить кэширование, CDN или по крайней мере ограничить «горячие» файлы в S3.
      
5. **Горизонтальное масштабирование**
    - Перевести ключевые сервисы (Shop, CRM, MES) на контейнеры или добавить авто-масштабируемые группы EC2.
    - Масштабировать базу на чтение (реплики), если растёт нагрузка.
      
6. **Ускорение релизов и автотесты**
    - Настроить CI/CD с автоматическими регрессионными тестами.
    - Разгрузить QA-инженера, увеличить долю автоматизации.

---

## 3. Приоритизация инициатив и видение целевой архитектуры

### Целевая архитектура через полгода

Через полгода система должна достичь нескольких ключевых целей:

1. RabbitMQ в отказоустойчивой конфигурации; очереди настроены на двунаправленный обмен между CRM и MES.
2. Отдельная подсистема для расчёта стоимости, которую можно горизонтально масштабировать независимо от MES API.
3. Наблюдаемость: трейсинг (OpenTelemetry → Jaeger), метрики (Prometheus / Alert Manager / Grafana) и логирование в едином центре (ELK или Loki/Grafana).
4. Оптимизированная работа с 3D Files Storage: возможно единый сервис для всех «файловых» операций, кэширование.
5. CI/CD с автотестами (минимум smoke/regression), чтобы релизы шли без месячных задержек.

### Топ-3 инициативы на ближайшие полгода

1. Повышение надёжности RabbitMQ и мониторинг (кластер, алертинг по задержкам и dead-letter).
2. Вынос расчёта стоимости в отдельный воркер/микросервис (убрать блокировки из MES API).
3. Внедрение трейсинга и базового набора автотестов (так мы сможем быстро находить проблемы и проводить релизы).




