## 1. Анализ проблемных мест

1. **Увеличение числа «просроченных» заказов и нестабильность в обработке**  
   - Нарушения SLA по срокам (ожидали 3 недели, а выходит больше).  
   - Не все заказы доходят до производства, есть жалобы, что «заказ пропал» или «никто не взял заказ».

2. **Проблемы масштабирования и производительности**  
   - Выросшая нагрузка от B2B-заказчиков (открытое API), а также естественный линейный рост B2C-заказов.  
   - Долгое время расчёта (до 30 минут) при сложных 3D-моделях, что создаёт «бутылочное горлышко».  
   - MES-страница с большим количеством заказов тормозит при загрузке (даже с фильтрами и пагинацией).

3. **Ограничения текущей инфраструктуры**  
   - Каждое приложение запущено в одном инстансе (один сервер EC2).  
   - В БД нет деления на чтение/запись (один инстанс), возможны проблемы с производительностью при росте нагрузки.  
   - Потенциальное узкое место — RabbitMQ, если количество сообщений резко возрастёт, особенно при единичной инсталляции брокера.

4. **Несовершенная интеграция MES ↔ CRM ↔ Shop API**  
   - Обмен сообщениями сильно завязан на RabbitMQ, при этом расчёт стоимости и статусы синхронизируются асинхронно. Есть риск потерянных или продублированных сообщений при резком росте нагрузки.  
   - Возможны гонки состояний заказов: разные приложения по-разному видят статус (нет чёткого механизма консенсуса при сбоях).

5. **Отсутствие (или недостаточность) автоматизированного E2E-тестирования**  
   - QA-инженер вручную проводит сценарии на тестовом окружении. Если находят баги уровня high/highest, релиз блокируется.  
   - Увеличение количества фич и поддерживаемых интеграций ведёт к росту числа регрессий и потенциальным задержкам релизов на недели.

6. **Сложности с мониторингом и наблюдаемостью (Observability)**  
   - Нет информации о том, как собираются метрики по RabbitMQ, микросервисам, БД.  
   - Длительные задержки с выяснением причины: сложно точно определить, почему заказ «завис», без детального трекинга сообщений и статусов.

7. **Неэффективная работа операторов в MES**  
   - Интерфейс перегружен, долго грузится список заказов.  
   - Операторы хотят обрабатывать новые заказы оперативно (это влияет на их вознаграждение), но страница долго грузится, фильтр и пагинация не спасают.

8. **Организационные проблемы (процессы релизов, роль QA)**  
   - Каждый релиз откладывается при обнаружении критических багов, что не всегда эффективно при большой продуктовой нагрузке.  
   - Команде может не хватать специалистов (особенно по автоматизации тестирования, DevOps-экспертизе, React).

---

## 2. Перечень инициатив

Ниже перечислены инициативы (от крупных изменений уровня «эпик» до точечных доработок). В дальнейшем их можно группировать и детализировать:

1. **Масштабирование инфраструктуры и сервисов**  
   - Перенос существующих сервисов (Shop API, CRM API, MES API) на контейнеры (Docker/Kubernetes) или использование группировки нескольких EC2-инстансов с балансировкой.  
   - Добавление реплик для БД (по крайней мере для чтения).  
   - Масштабирование RabbitMQ (кластер или высокодоступная конфигурация).

2. **Оптимизация расчёта стоимости (MES)**  
   - Выделение подсистемы (микросервиса) для расчёта стоимости в очередь или бэкенд-джобы (async worker).  
   - Механизм очередей задач и масштабирование воркеров, чтобы параллелить расчёты.  
   - Возможное профилирование кода, оптимизация/рефакторинг вычислительных алгоритмов.

3. **Разработка улучшенного механизма управления заказами и состояниями**  
   - Внедрение паттерна «Saga»/«Orchestration» (или использование централизованного workflow-сервера) для синхронизации статусов между системами.  
   - Чёткая трассировка (trace ID, correlation ID) по всем сообщениям в RabbitMQ, чтобы мы могли найти точку сбоя.

4. **Обновление интерфейса и логики MES**  
   - Рефакторинг фронтенда MES (React) для оптимизации отображения списка заказов.  
   - Выделение «быстрого списка» новых заказов и улучшение фильтрации/поиска.  
   - Гибкая пагинация, lazy-loading, обновление данных в реальном времени (websocket или SSE) для операторов.

5. **Внедрение продвинутого мониторинга, логирования, алертинга**  
   - Настройка сборки метрик (Prometheus / Grafana, либо Yandex Cloud Monitoring) для каждого сервиса и для RabbitMQ.  
   - Централизованные логи (ELK, Loki + Grafana, Splunk и др.).  
   - Настройка alerting (по задержкам сообщений в очереди, по долгим запросам к БД, по времени расчёта).

6. **Автоматизация тестирования и ускорение релизного цикла**  
   - Внедрение CI/CD-пайплайна с автоматическими интеграционными (E2E) тестами.  
   - Сборка и прогон тестов в контейнерах (например, TestContainers, Docker-compose).  
   - Постепенный перевод ручных тестов в автоматические (Selenium, Cypress, Playwright и т.д. для фронта; интеграционные тесты для бэкенда).

7. **Улучшение управления нагрузкой и кэширования**  
   - Возможно, вынести часть API-запросов в кэш, например, для списка товаров, справочников.  
   - Доработка системы хранения 3D-файлов (S3-based storage) так, чтобы выгрузка и расчёт не мешали производительности ядра приложения.

8. **Ревизия организационной структуры и ролей**  
   - Нанять/переквалифицировать ещё одного/двух QA-инженеров, специализирующихся на автоматизации.  
   - Укрепить DevOps-практики (дополнительный инженер или расширение экспертизы) для перехода на кластерное развёртывание.  
   - Возможно, выделить отдельного архитектора/техлида на MES, если там основные «узкие места».

---

## 3. Приоритизация инициатив и видение целевой архитектуры

### Целевая архитектура через полгода

Через полгода система должна достичь нескольких ключевых целей:

1. **Горизонтальное масштабирование основных сервисов**  
   - Shop API, CRM API, MES API работают в кластерном окружении (k8s или автоматическое масштабирование на EC2 с балансировщиком).  
   - RabbitMQ развёрнут в отказоустойчивом (HA) режиме или кластере, чтобы выдерживать всплески нагрузки и не терять сообщения.

2. **Асинхронный и надёжный механизм расчётов**  
   - Расчёты стоимости заказа вынесены в микросервис (или как минимум в отдельный воркер), который масштабируется независимо от MES API.  
   - Очереди задач и система мониторинга прогресса, чтобы всегда видеть, на каком этапе находится расчёт.

3. **Продвинутая наблюдаемость и логирование**  
   - Любые задержки в очередях, сбои в сервисах и «подвисшие» заказы оперативно видны в мониторинге.  
   - У каждого заказа есть уникальный идентификатор трассировки, который проходит через все сервисы.

4. **Ускоренный релизный цикл с автоматическими тестами**  
   - Базовые регрессионные E2E-тесты автоматизированы, прогоняются при каждом pull-request’е.  
   - Высококритичные дефекты отлавливаются на ранних стадиях (на dev и release окружениях), сокращая риск «срывов» релизов в прод.

5. **Оптимизированный UI/UX для MES**  
   - Операторы быстро видят новые заказы без долгих прогрузок.  
   - Интерфейс предоставляет эффективные инструменты для фильтрации, взятия заказа в работу, перехода по статусам.

Таким образом, компания сможет обрабатывать увеличенное количество заказов (в том числе от партнёров по API) и снизит риск потери клиентов.

### Топ-3 инициативы на ближайшие полгода

Если предположить, что ресурсов хватит только на три инициативы, я бы выделил следующее (с учётом критичности проблем):

1. **Организация масштабируемой и надёжной обработки заказов (фокус на MES и RabbitMQ)**  
   - Вынести расчёт стоимости в отдельный воркер/микросервис. Настроить масштабирование (горизонтальное либо через Kubernetes/контейнеры).  
   - Обеспечить HA-конфигурацию RabbitMQ и настроить метрики, чтобы видеть очереди, задержки и количество сообщений.  
   
   Это критично для устранения «бутылочного горлышка» (самая частая жалоба — заказы зависают и не обрабатываются).

2. **Обновление и оптимизация MES-фронтенда + UX для операторов**  
   - Серьёзно переработать загрузку списка заказов (лучший фильтр, lazy loading, приоритет новых заказов, real-time оповещения).  
   - Снять ключевую боль у операторов: сейчас всё тормозит, из-за чего заказы физически не могут быть взяты в работу вовремя.  
   
   Ускорение работы операторов прямо влияет на пропускную способность производства и на показатели SLA.

3. **Автоматизация тестирования и улучшение релизного цикла**  
   - Внедрить интеграционные и базовые E2E-тесты, которые запускаются автоматически (CI/CD pipeline).  
   - Сократить время на регрессию, уменьшить количество критических багов, срывающих релизы.  
   
   Без этого даже при масштабировании сервисов может накапливаться технический долг и новые баги, что ведёт к дальнейшим задержкам.

**Почему именно эти три?**  
- Первые две инициативы напрямую решают самую острую проблему — «пропадающие/зависшие заказы» и «невозможность быстро взять заказ в работу». Если мы не оптимизируем MES и не обеспечим стабильный расчёт стоимости, то дальнейший рост заказов только усугубит ситуацию.  
- Третья инициатива (автотесты) не даёт мгновенного эффекта для пользователей, но стратегически важна, чтобы не замедляться и не «ломать» систему дальше. Иначе, даже устранив узкое место в производительности, мы «утонем» в некачественных релизах и bugfix-горячках.

---

## Заключение

В результате данных шагов «Александрит» сможет:  
1. Повысить надёжность и масштабируемость ключевых компонентов (MES API, RabbitMQ).  
2. Ускорить работу операторов и свести к минимуму «пропадающие» заказы.  
3. Снизить риски срыва релизов за счёт автоматизации тестирования и более гибкого CI/CD.  

Это позволит компании продолжить рост на B2C- и B2B-рынках без потери качества обслуживания.
